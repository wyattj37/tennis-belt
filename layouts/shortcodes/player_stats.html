<!-- Include the sortable JS -->
<script src="https://cdn.jsdelivr.net/gh/tofsjonas/sortable@latest/sortable.min.js"></script>

<!-- Toggle header -->
<div style="display:flex; justify-content:flex-end; align-items:flex-start; max-width:900px; margin:1rem auto; gap:1rem; flex-wrap:wrap;">
  <div id="stats-text" style="flex:1; text-align:left; line-height:1.3;">
    <!-- Initial text, will be updated by JS -->
  </div>

  <button id="stats-toggle-btn" style="
      padding:0.3rem 0.8rem;
      font-size:0.95rem;
      font-weight:bold;
      background-color:#0d6efd;
      color:white;
      border:none;
      border-radius:4px;
      cursor:pointer;
      white-space:nowrap;
  ">WTA</button>
</div>

<style>
/* Shared table style */
.player-stats {
  width: 100%;
  max-width: 900px;
  margin: 1rem auto 2rem auto;
  border-collapse: collapse;
  font-family: system-ui, sans-serif;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  background: #fff;
  border-radius: 8px;
  overflow: hidden;
}

.player-stats thead {
  background-color: #3d7fe1;
  color: #fff;
  text-align: left;
}

.player-stats th {
  padding: 0.75rem 1rem;
  cursor: pointer;
  user-select: none;
}

.player-stats td {
  padding: 0.5rem 1rem;
  color: #111;
}

.player-stats td:nth-child(n+2),
.player-stats th:nth-child(n+2) {
  text-align: right;
}

.player-stats tbody tr:nth-child(even) {
  background-color: #f9f9f9;
}

.player-stats tbody tr:hover {
  background-color: #e6f0ff;
}

/* Stats key */
.stats-key {
  max-width: 900px;
  margin: 1.5rem auto;
  padding: 1rem 1.5rem;
  background-color: #f5f5f5ed;
  border-left: 4px solid #3d7fe1;
  border-radius: 6px;
  font-family: system-ui, sans-serif;
  line-height: 1.4;
  display: grid;
  grid-template-columns: 150px 1fr;
  row-gap: 0.5rem;
  column-gap: 1rem;
}

.stats-key dt {
  font-weight: 600;
  color: #555;
}

.stats-key dd {
  margin: 0;
  color: #555;
}
</style>

<dl class="stats-key">
  <dt>Reigns</dt><dd>Number of separate stints holding the belt</dd>
  <dt>Total Defenses</dt><dd>Total number of matches successfully defending the belt</dd>
  <dt>Consec. Defenses</dt><dd>Maximum consecutive defenses during one reign</dd>
  <dt>Wins</dt><dd>Wins in belt matches</dd>
  <dt>Losses</dt><dd>Losses in belt matches</dd>
  <dt>Total Matches</dt><dd>Total belt matches played</dd>
  <dt>Win Rate</dt><dd>Win rate in belt matches</dd>
</dl>

<div style="position: relative; max-width:900px; margin:auto;">
  <!-- ATP Table (visible by default) -->
  <table id="player-stats-atp" class="player-stats sortable">
    <colgroup>
      <col style="width:23%">
      <col style="width:11%">
      <col style="width:11%">
      <col style="width:11%">
      <col style="width:11%">
      <col style="width:11%">
      <col style="width:11%">
      <col style="width:11%">
    </colgroup>
    <thead>
      <tr>
        <th>Name</th>
        <th>Reigns</th>
        <th>Total Defenses</th>
        <th>Consec. Defenses</th>
        <th>Wins</th>
        <th>Losses</th>
        <th>Total Matches</th>
        <th>Win Rate</th>
      </tr>
    </thead>
    <tbody>
      {{ range .Page.Site.Data.player_stats }}
      <tr>
        <td>{{ .winner_name }}</td>
        <td>{{ .reign_number }}</td>
        <td>{{ .total_defenses }}</td>
        <td>{{ .defenses }}</td>
        <td>{{ .W }}</td>
        <td>{{ .L }}</td>
        <td>{{ .total_matches }}</td>
        <td data-sort="{{ .win_rate }}">{{ printf "%.1f%%" (mul .win_rate 100) }}</td>
      </tr>
      {{ end }}
    </tbody>
  </table>

  <!-- WTA Table (hidden by default) -->
  <table id="player-stats-wta" class="player-stats sortable" style="display:none;">
    <colgroup>
      <col style="width:23%">
      <col style="width:11%">
      <col style="width:11%">
      <col style="width:11%">
      <col style="width:11%">
      <col style="width:11%">
      <col style="width:11%">
      <col style="width:11%">
    </colgroup>
    <thead>
      <tr>
        <th>Name</th>
        <th>Reigns</th>
        <th>Total Defenses</th>
        <th>Consec. Defenses</th>
        <th>Wins</th>
        <th>Losses</th>
        <th>Total Matches</th>
        <th>Win Rate</th>
      </tr>
    </thead>
    <tbody>
      {{ range .Page.Site.Data.wta_player_stats }}
      <tr>
        <td>{{ .winner_name }}</td>
        <td>{{ .reign_number }}</td>
        <td>{{ .total_defenses }}</td>
        <td>{{ .defenses }}</td>
        <td>{{ .W }}</td>
        <td>{{ .L }}</td>
        <td>{{ .total_matches }}</td>
        <td data-sort="{{ .win_rate }}">{{ printf "%.1f%%" (mul .win_rate 100) }}</td>
      </tr>
      {{ end }}
    </tbody>
  </table>
</div>

<script>
(function() {
  const btn = document.getElementById("stats-toggle-btn");
  const atpTable = document.getElementById("player-stats-atp");
  const wtaTable = document.getElementById("player-stats-wta");
  let currentTour = "atp";

  btn.addEventListener("click", function() {
    if (currentTour === "atp") {
      currentTour = "wta";
      atpTable.style.display = "none";
      wtaTable.style.display = "table";
      btn.textContent = "ATP";
    } else {
      currentTour = "atp";
      atpTable.style.display = "table";
      wtaTable.style.display = "none";
      btn.textContent = "WTA";
    }
  });
})();
</script>

<script>
(function() {
  const btn = document.getElementById("stats-toggle-btn");
  const textDiv = document.getElementById("stats-text");

  // Prepare data for ATP and WTA
  const atpPlayers = {{ .Page.Site.Data.player_stats | jsonify | safeJS }};
  const wtaPlayers = {{ .Page.Site.Data.wta_player_stats | jsonify | safeJS }};

  let currentTour = "atp";

  function updateText() {
    const players = currentTour === "atp" ? atpPlayers : wtaPlayers;
    const uniqueNames = [...new Set(players.map(p => p.winner_name))];
    textDiv.innerHTML = `Stats for all of the ${uniqueNames.length} players to ever hold the belt.<br>
                         Click any column name to sort by that column. Here's a key:`;
  }

  // Initialize text
  updateText();

  btn.addEventListener("click", function() {
    currentTour = currentTour === "atp" ? "wta" : "atp";
    btn.textContent = currentTour === "atp" ? "WTA" : "ATP";
    updateText();
    // Toggle table visibility here if needed
  });
})();
</script>